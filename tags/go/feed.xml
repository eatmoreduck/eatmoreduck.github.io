<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>go on eatmoreduck</title><link>/tags/go/</link><description>Recent content in go on eatmoreduck</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sun, 03 Nov 2024 00:00:00 +0800</lastBuildDate><atom:link href="/tags/go/feed.xml" rel="self" type="application/rss+xml"/><item><title>DXP4800-黑群晖小记</title><link>/p/dxp4800-synology/</link><pubDate>Sun, 03 Nov 2024 00:00:00 +0800</pubDate><guid>/p/dxp4800-synology/</guid><description>&lt;p>黑群晖安装步骤略，引导盘+ 关闭内置 EMMC 网上教程比较多，不过多赘述，安装参考&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">绿联nas 关闭watchdog 及修改启动方式教程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[https://post.smzdm.com/p/a3xnev8n/](https://post.smzdm.com/p/a3xnev8n/)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">绿联黑群晖
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[https://post.smzdm.com/p/a07nw4zr/](https://post.smzdm.com/p/a07nw4zr/)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">黑群晖安装教程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[https://post.smzdm.com/p/akk9vpkr/](https://post.smzdm.com/p/akk9vpkr/)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024 年就 10 月黑群晖 nas 教程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[https://www.bilibili.com/video/BV1XN2QYWEAi/?spm_id_from=333.337.search-card.all.click&amp;amp;vd_source=c50111db380d4669d222dbf4f28aa85a](https://www.bilibili.com/video/BV1XN2QYWEAi/?spm_id_from=333.337.search-card.all.click&amp;amp;vd_source=c50111db380d4669d222dbf4f28aa85a)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="已解决">已解决&lt;/h2>
&lt;ol>
&lt;li>解决视频HEIC不能播放问题，需要安装 AME 套件并激活，参见 &lt;a class="link" href="https://post.smzdm.com/p/a7pw05r9/" target="_blank" rel="noopener"
>https://post.smzdm.com/p/a7pw05r9/&lt;/a>&lt;/li>
&lt;li>更新小红点问题： 更改/etc/host,增加127.0.0.1 update.synology.com（未解决，后续再做）&lt;/li>
&lt;li>MOV 视频封面不显示问题，升级ffmpeg 套件，从 4 升级到 6 后重建索引解决 ，参见 &lt;a class="link" href="https://blog.csdn.net/qq_44726883/article/details/140429626" target="_blank" rel="noopener"
>https://blog.csdn.net/qq_44726883/article/details/140429626&lt;/a>&lt;/li>
&lt;li>硬盘灯闪烁问题，不影响使用，故暂不解决，参见&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">https://www.langog.com/?p=0f263caf-d8a0-4627-b458-7f1df146b88a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://github.com/miskcoo/ugreen_leds_controller
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ol start="5">
&lt;li>群晖信息显示监控 ，ssh 安装 sensors 插件即可，&lt;a class="link" href="https://post.smzdm.com/p/a8xze450/" target="_blank" rel="noopener"
>https://post.smzdm.com/p/a8xze450/&lt;/a>，后期使用hertzbeat 统一监控（11 月 1 日解决问题 3 后，重建索引时，发现 cpu 温度跟面板温度似乎一样&lt;/li>
&lt;li>风扇问题，风扇无法自定义调节转速，暂时直接拉风速到 100 参见连接
&lt;a class="link" href="https://post.smzdm.com/p/a0xk4el8/?sort_tab=hot/#comments" target="_blank" rel="noopener"
>https://post.smzdm.com/p/a0xk4el8/?sort_tab=hot/#comments&lt;/a>&lt;/li>
&lt;li>外网访问,zerotier 已打通内外网访问，自建 planet 来搞定外网访问问题&lt;/li>
&lt;li>公网 ip v4 已开通，ddns-go + 端口转发 + Let’s Encrypt 完成整个网络搭建&lt;/li>
&lt;li>软件问题，主要设备平台为Android + mac 常用软件下载参考&lt;a class="link" href="https://www.synology.cn/zh-cn/support/download?version=7.2#utilities" target="_blank" rel="noopener"
>https://www.synology.cn/zh-cn/support/download?version=7.2#utilities&lt;/a>&lt;/li>
&lt;li>nas 内置docker 容器跑
&lt;ol>
&lt;li>&lt;del>immich作为群晖相册补充&lt;/del> （因群晖相册已足够，暂时不用）&lt;/li>
&lt;li>jellyfin&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>2015mac docker容器
&lt;ol>
&lt;li>heatzbeat 做为整个局域网的监控&lt;/li>
&lt;li>alist 挂百度网盘，夸克网盘，阿里云网盘&lt;/li>
&lt;li>gitlab&lt;/li>
&lt;li>gitlab-runner&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;p>经过一系列折腾之后，目前公网访问已经无问题，如果 ddns 挂了，也有自建 zerotier 能作为补充使用，后续考虑加一个 UPS 及两条 512 的 SSD 组 raid1 作为 docker 及虚拟机盘&lt;/p>
&lt;h2 id="待办">待办&lt;/h2>
&lt;ol>
&lt;li>&lt;del>因使用内置ddns 时出现过梅林固件上的 clash 规则问题，导致 ddns 出现错误的 ip（实际为代理的 ip），后续考虑增加一个软路由&lt;/del> （新版 Merlin Clash已支持自定义规则，可以在访问 api.cloudflare.com 时不使用代理）&lt;/li>
&lt;li>公网 ipv4 访问不是很安全，考虑后续将 ddns 迁移到群晖中，直接开ipv6 访问&lt;/li>
&lt;li>&lt;del>群晖链路聚合开启&lt;/del> （RAX50 不支持链路聚合，lan 口只能到千兆，跑不满绿联 2.5G 带宽）&lt;/li>
&lt;li>时间机器构建&lt;/li>
&lt;li>mac 常用文件自动备份到群晖任务构建&lt;/li>
&lt;li>冷备份任务构建&lt;/li>
&lt;li>2015mac docker容器配置及配置文件备份&lt;/li>
&lt;li>7 中的关键任务自动同步到群晖防丢失&lt;/li>
&lt;li>考虑将此次黑裙关键步骤细化，落为文档，防丢失&lt;/li>
&lt;li>风扇自动调速脚本配置，目前弄了个简版，后续再配置和优化&lt;/li>
&lt;/ol>
&lt;h2 id="风扇转速脚本待测试">风扇转速脚本（待测试）&lt;/h2>
&lt;p>保存为 fan_control.sh，然后执行脚本&lt;/p>
&lt;p>chmod +x fan_control.sh
sudo ./fan_control.sh&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">FAN_CONTROL&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;/sys/devices/platform/it87.2608/hwmon/hwmon2/pwm3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 检查必要的命令是否存在&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">command&lt;/span> -v sensors &amp;gt;/dev/null 2&amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;需要安装 lm-sensors，请先运行: apt-get install lm-sensors&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nb">exit&lt;/span> 1&lt;span class="p">;&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">command&lt;/span> -v bc &amp;gt;/dev/null 2&amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;需要安装 bc，请先运行: apt-get install bc&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nb">exit&lt;/span> 1&lt;span class="p">;&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 检查文件权限和路径&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> ! -w &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$FAN_CONTROL&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;错误: 无法写入风扇控制文件 &lt;/span>&lt;span class="nv">$FAN_CONTROL&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;请确保以root权限运行此脚本&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 检查风扇控制模式设置是否成功&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> ! &lt;span class="nb">echo&lt;/span> &lt;span class="m">1&lt;/span> &amp;gt; /sys/devices/platform/it87.2608/hwmon/hwmon2/pwm3_enable&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;错误: 无法设置风扇控制模式&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 初始化变量&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">declare&lt;/span> -a &lt;span class="nv">temp_history&lt;/span>&lt;span class="o">=()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">current_pwm&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">85&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">NORMAL_INTERVAL&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">15&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">HIGH_TEMP_INTERVAL&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">TEMP_THRESHOLD&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">45&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">MIN_PWM&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">55&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">MAX_PWM&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">LOG_FILE&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;/var/log/fan_control.log&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 创建日志文件（如果不存在）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">touch &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$LOG_FILE&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> 2&amp;gt;/dev/null &lt;span class="o">||&lt;/span> &lt;span class="o">{&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;错误: 无法创建日志文件&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nb">exit&lt;/span> 1&lt;span class="p">;&lt;/span> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 温度读取函数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">get_temp&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">local&lt;/span> temp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">temp&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>sensors &lt;span class="p">|&lt;/span> grep &lt;span class="s2">&amp;#34;Package id 0:&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> awk &lt;span class="s1">&amp;#39;{print $4}&amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> tr -d &lt;span class="s1">&amp;#39;+°C&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 检查温度读取是否成功&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">[[&lt;/span> ! &lt;span class="nv">$temp&lt;/span> &lt;span class="o">=&lt;/span>~ ^&lt;span class="o">[&lt;/span>0-9&lt;span class="o">]&lt;/span>+&lt;span class="o">(&lt;/span>&lt;span class="se">\.&lt;/span>&lt;span class="o">[&lt;/span>0-9&lt;span class="o">]&lt;/span>+&lt;span class="o">)&lt;/span>?$ &lt;span class="o">]]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;错误: 无法正确读取温度&amp;#34;&lt;/span> &amp;gt;&amp;gt; &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$LOG_FILE&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 检查温度是否在合理范围内 (-20到100度)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">((&lt;/span> &lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$temp&lt;/span>&lt;span class="s2"> &amp;lt; -20 || &lt;/span>&lt;span class="nv">$temp&lt;/span>&lt;span class="s2"> &amp;gt; 100&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> bc -l&lt;span class="k">)&lt;/span> &lt;span class="o">))&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;警告: 温度读数异常: &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">temp&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">°C&amp;#34;&lt;/span> &amp;gt;&amp;gt; &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$LOG_FILE&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$temp&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 设置风扇转速函数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">set_fan_speed&lt;span class="o">()&lt;/span> &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">local&lt;/span> &lt;span class="nv">pwm&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 确保PWM值在有效范围内&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="nv">$pwm&lt;/span> -lt &lt;span class="nv">$MIN_PWM&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">pwm&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$MIN_PWM&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="nv">$pwm&lt;/span> -gt &lt;span class="nv">$MAX_PWM&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">pwm&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$MAX_PWM&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 尝试设置风扇转速&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> ! &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$pwm&lt;/span> &amp;gt; &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$FAN_CONTROL&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;错误: 设置风扇转速失败: &lt;/span>&lt;span class="nv">$pwm&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &amp;gt;&amp;gt; &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$LOG_FILE&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 主循环&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">while&lt;/span> true&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 获取CPU温度&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">TEMP&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>get_temp&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="nv">$?&lt;/span> -ne &lt;span class="m">0&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 温度读取失败，使用保守的风扇设置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;警告: 温度读取失败，使用默认风扇设置&amp;#34;&lt;/span> &amp;gt;&amp;gt; &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$LOG_FILE&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set_fan_speed &lt;span class="m">150&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sleep &lt;span class="nv">$NORMAL_INTERVAL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">continue&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 根据温度设置检测间隔&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">((&lt;/span> &lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$TEMP&lt;/span>&lt;span class="s2"> &amp;gt;= &lt;/span>&lt;span class="nv">$TEMP_THRESHOLD&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> bc -l&lt;span class="k">)&lt;/span> &lt;span class="o">))&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">sleep_interval&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$HIGH_TEMP_INTERVAL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">sleep_interval&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$NORMAL_INTERVAL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 设置目标风扇转速&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">((&lt;/span> &lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$TEMP&lt;/span>&lt;span class="s2"> &amp;lt; 30&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> bc -l&lt;span class="k">)&lt;/span> &lt;span class="o">))&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">target_pwm&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$MIN_PWM&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="o">((&lt;/span> &lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$TEMP&lt;/span>&lt;span class="s2"> &amp;gt;= 30 &amp;amp;&amp;amp; &lt;/span>&lt;span class="nv">$TEMP&lt;/span>&lt;span class="s2"> &amp;lt; 35&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> bc -l&lt;span class="k">)&lt;/span> &lt;span class="o">))&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">target_pwm&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">85&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="o">((&lt;/span> &lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$TEMP&lt;/span>&lt;span class="s2"> &amp;gt;= 35 &amp;amp;&amp;amp; &lt;/span>&lt;span class="nv">$TEMP&lt;/span>&lt;span class="s2"> &amp;lt; 40&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> bc -l&lt;span class="k">)&lt;/span> &lt;span class="o">))&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">target_pwm&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">120&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="o">((&lt;/span> &lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$TEMP&lt;/span>&lt;span class="s2"> &amp;gt;= 40 &amp;amp;&amp;amp; &lt;/span>&lt;span class="nv">$TEMP&lt;/span>&lt;span class="s2"> &amp;lt; 45&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> bc -l&lt;span class="k">)&lt;/span> &lt;span class="o">))&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">target_pwm&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">150&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="o">((&lt;/span> &lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$TEMP&lt;/span>&lt;span class="s2"> &amp;gt;= 45 &amp;amp;&amp;amp; &lt;/span>&lt;span class="nv">$TEMP&lt;/span>&lt;span class="s2"> &amp;lt; 50&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> bc -l&lt;span class="k">)&lt;/span> &lt;span class="o">))&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">target_pwm&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">180&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="o">((&lt;/span> &lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$TEMP&lt;/span>&lt;span class="s2"> &amp;gt;= 50 &amp;amp;&amp;amp; &lt;/span>&lt;span class="nv">$TEMP&lt;/span>&lt;span class="s2"> &amp;lt; 55&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> bc -l&lt;span class="k">)&lt;/span> &lt;span class="o">))&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">target_pwm&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="o">((&lt;/span> &lt;span class="k">$(&lt;/span>&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$TEMP&lt;/span>&lt;span class="s2"> &amp;gt;= 55 &amp;amp;&amp;amp; &lt;/span>&lt;span class="nv">$TEMP&lt;/span>&lt;span class="s2"> &amp;lt; 60&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> bc -l&lt;span class="k">)&lt;/span> &lt;span class="o">))&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">target_pwm&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">225&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">target_pwm&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$MAX_PWM&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 平滑过渡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="nv">$target_pwm&lt;/span> -gt &lt;span class="nv">$current_pwm&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">current_pwm&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$((&lt;/span> current_pwm &lt;span class="o">+&lt;/span> &lt;span class="m">8&lt;/span> &lt;span class="k">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="nv">$target_pwm&lt;/span> -lt &lt;span class="nv">$current_pwm&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">current_pwm&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$((&lt;/span> current_pwm &lt;span class="o">-&lt;/span> &lt;span class="m">3&lt;/span> &lt;span class="k">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 确保PWM值在有效范围内并设置风扇转速&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> ! set_fan_speed &lt;span class="nv">$current_pwm&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;错误: 风扇控制失败，等待下次尝试&amp;#34;&lt;/span> &amp;gt;&amp;gt; &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$LOG_FILE&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sleep &lt;span class="nv">$NORMAL_INTERVAL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">continue&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 记录日志，同时检查日志文件大小&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">log_size&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>stat -f %z &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$LOG_FILE&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> 2&amp;gt;/dev/null &lt;span class="o">||&lt;/span> &lt;span class="nb">echo&lt;/span> 0&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> &lt;span class="nv">$log_size&lt;/span> -gt &lt;span class="m">10485760&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span> &lt;span class="c1"># 10MB&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mv &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$LOG_FILE&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">LOG_FILE&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">.old&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> touch &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$LOG_FILE&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="k">$(&lt;/span>date &lt;span class="s1">&amp;#39;+%Y-%m-%d %H:%M:%S&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>&lt;span class="s2"> - Temp: &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">TEMP&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">°C, PWM: &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">current_pwm&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">, Interval: &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">sleep_interval&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">s&amp;#34;&lt;/span> &amp;gt;&amp;gt; &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$LOG_FILE&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 使用trap捕获信号&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">trap&lt;/span> &lt;span class="s1">&amp;#39;echo &amp;#34;收到终止信号，设置风扇为默认值并退出...&amp;#34;; set_fan_speed 150; exit 0&amp;#39;&lt;/span> SIGTERM SIGINT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sleep &lt;span class="nv">$sleep_interval&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>VScode进入报错code 9, signal null error</title><link>/p/vscode-code-9-error/</link><pubDate>Fri, 16 Aug 2024 10:07:54 +0800</pubDate><guid>/p/vscode-code-9-error/</guid><description>&lt;p>进入 Vscode 时，出现报错&lt;br>
Unable to resolve your shell environment: Unexpected exit code from spawned shell (code 9, signal null)&lt;/p>
&lt;p>![image.png](&lt;a class="link" href="https://cdn.jsdelivr.net/gh/eatmoreduck/picture-repository/blog/202408161008789.png" target="_blank" rel="noopener"
>https://cdn.jsdelivr.net/gh/eatmoreduck/picture-repository/blog/202408161008789.png&lt;/a> =600x)&lt;/p>
&lt;p>查证go 和 go env 之后发现都没问题，最后注意到 ~/.bash_profile 中有这部分，确定造成报错的行是 &lt;strong>export NODE_OPTIONS=&amp;ndash;openssl-legacy-provider&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#node
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">export PATH=&amp;#34;/opt/homebrew/opt/node@20/bin:$PATH&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">export LDFLAGS=&amp;#34;-L/opt/homebrew/opt/node@20/lib:$LDFLAGS&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">export CPPFLAGS=&amp;#34;-I/opt/homebrew/opt/node@20/include:$CPPFLAGS&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">export NODE_OPTIONS=--openssl-legacy-provider
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>使用vi编辑或者是使用其他文本编辑器打开 .bash_profile 文件&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">vi ~/.bash_profile
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">按i进入编辑模式
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">找到export NODE_OPTIONS=--openssl-legacy-provider 所在行
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">在 export NODE_OPTIONS=--openssl-legacy-provider 前加#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">最后那行变成
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#export NODE_OPTIONS=--openssl-legacy-provider
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">再按 esc 退出编辑模式
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">:wq!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">然后回车
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果不会使用 vi 可以直接终端执行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cd $HOME &amp;amp; open .
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后用喜欢的文本编辑器打开.bash_profile 更改所在行&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/eatmoreduck/picture-repository/blog/202409101100157.png"
loading="lazy"
alt="image.png"
>&lt;/p>
&lt;p>将NODE_OPTIONS 注释掉后，重新进入 VScode 解决&lt;/p></description></item><item><title>hugo+obsidian打造最强博客（一）</title><link>/p/hugo-obsidian-stagic-blog1/</link><pubDate>Tue, 20 Feb 2024 16:27:01 +0800</pubDate><guid>/p/hugo-obsidian-stagic-blog1/</guid><description>&lt;h2 id="笔记软件选择原则">笔记软件选择原则&lt;/h2>
&lt;ol>
&lt;li>拒绝云服务，数据留存本地，本机运行，使用github/gitee 私仓来进行笔记储存&lt;/li>
&lt;li>拒绝专有格式，使用通用的标记型语言&lt;/li>
&lt;li>开源&lt;/li>
&lt;li>跨平台&lt;/li>
&lt;/ol>
&lt;h2 id="本地笔记格式选择">本地笔记格式选择&lt;/h2>
&lt;p>这个自是不必多说，首选MarkDown格式，方便各类软件编辑，关于此格式，参见wiki &lt;a class="link" href="https://zh.wikipedia.org/wiki/Markdown" target="_blank" rel="noopener"
>https://zh.wikipedia.org/wiki/Markdown&lt;/a>&lt;/p>
&lt;p>&lt;strong>Markdown&lt;/strong>是一种&lt;a class="link" href="https://zh.wikipedia.org/wiki/%E8%BD%BB%E9%87%8F%E7%BA%A7%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80" title="轻量级标记语言"
target="_blank" rel="noopener"
>轻量级标记语言&lt;/a>，创始人为&lt;a class="link" href="https://zh.wikipedia.org/wiki/%E7%B4%84%E7%BF%B0%C2%B7%E6%A0%BC%E9%AD%AF%E4%BC%AF" title="约翰·格鲁伯"
target="_blank" rel="noopener"
>约翰·格鲁伯&lt;/a>。它允许人们使用易读易写的纯文本格式编写文档，然后转换成有效的&lt;a class="link" href="https://zh.wikipedia.org/wiki/XHTML" target="_blank" rel="noopener"
>XHTML&lt;/a>（或者&lt;a class="link" href="https://zh.wikipedia.org/wiki/HTML" title="HTML"
target="_blank" rel="noopener"
>HTML&lt;/a>）文档。&lt;a class="link" href="https://zh.wikipedia.org/wiki/Markdown#cite_note-md-4" target="_blank" rel="noopener"
>[4]&lt;/a>这种语言吸收了很多在&lt;a class="link" href="https://zh.wikipedia.org/wiki/%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6" title="电子邮件"
target="_blank" rel="noopener"
>电子邮件&lt;/a>中已有的纯文本标记的特性。&lt;/p>
&lt;p>由于Markdown的轻量化、易读易写特性，并且对于图片，图表、数学式都有支持，目前许多网站都广泛使用Markdown来撰写帮助文档或是用于&lt;a class="link" href="https://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E8%AE%BA%E5%9D%9B" title="网络论坛"
target="_blank" rel="noopener"
>论坛&lt;/a>上发表消息。如&lt;a class="link" href="https://zh.wikipedia.org/wiki/GitHub" title="GitHub"
target="_blank" rel="noopener"
>GitHub&lt;/a>、&lt;a class="link" href="https://zh.wikipedia.org/wiki/Reddit" title="Reddit"
target="_blank" rel="noopener"
>Reddit&lt;/a>、&lt;a class="link" href="https://zh.wikipedia.org/wiki/Discord" title="Discord"
target="_blank" rel="noopener"
>Discord&lt;/a>、&lt;a class="link" href="https://zh.wikipedia.org/wiki/Diaspora_%28%E7%A4%BE%E4%BA%A4%E7%BD%91%E7%BB%9C%29" title="Diaspora (社交网络)"
target="_blank" rel="noopener"
>Diaspora&lt;/a>、&lt;a class="link" href="https://zh.wikipedia.org/wiki/Stack_Exchange" title="Stack Exchange"
target="_blank" rel="noopener"
>Stack Exchange&lt;/a>、&lt;a class="link" href="https://zh.wikipedia.org/wiki/OpenStreetMap" title="OpenStreetMap"
target="_blank" rel="noopener"
>OpenStreetMap&lt;/a> 、&lt;a class="link" href="https://zh.wikipedia.org/wiki/SourceForge" title="SourceForge"
target="_blank" rel="noopener"
>SourceForge&lt;/a>、&lt;a class="link" href="https://zh.wikipedia.org/wiki/%E7%AE%80%E4%B9%A6" title="简书"
target="_blank" rel="noopener"
>简书&lt;/a>等，甚至还能被用来撰写&lt;a class="link" href="https://zh.wikipedia.org/wiki/%E9%9B%BB%E5%AD%90%E6%9B%B8" title="电子书"
target="_blank" rel="noopener"
>电子书&lt;/a>。&lt;/p>
&lt;h2 id="笔记格式软件选择">笔记格式软件选择&lt;/h2>
&lt;p>截止2024年2月20日，比较流行的MarkDown 编辑软件有如下几个选项&lt;/p>
&lt;ol>
&lt;li>语雀&lt;/li>
&lt;li>Typora&lt;/li>
&lt;li>VSCode&lt;/li>
&lt;li>Obsidian&lt;/li>
&lt;/ol>
&lt;h2 id="逐个分析不选用软件的原因">逐个分析不选用软件的原因&lt;/h2>
&lt;h4 id="语雀">语雀&lt;/h4>
&lt;p>语雀导入MarkDown方便，但导出功能并不是特别强大，MarkDown导入后，基本与语雀编辑器绑定，语雀官方文档上，有同学提出了希望能直接导出全知识库，但语雀团队并未提供相关支持。
&lt;img src="https://cdn.jsdelivr.net/gh/eatmoreduck/picture-repository/blog/202403041502909.png"
loading="lazy"
alt="image.png"
>
&lt;img src="https://cdn.jsdelivr.net/gh/eatmoreduck/picture-repository/blog/202403041502909.png"
loading="lazy"
alt="image.png"
>
&lt;img src="https://cdn.jsdelivr.net/gh/eatmoreduck/picture-repository/blog/202403041503941.png"
loading="lazy"
alt="image.png"
>&lt;/p>
&lt;p>原本我是语雀深度用户，团队内部使用语雀写文档，平时也是使用语雀做笔记，再配合chrome 的SimpRead 插件，方便的进行网上文章摘抄&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/eatmoreduck/picture-repository/blog/202403041523141.png"
loading="lazy"
alt="image.png"
>&lt;/p>
&lt;p>但2023年10月23日，语雀挂了8小时，我为此还发了朋友圈，那时候就想切换到其他笔记软件，墨迹了几个月，终于开始干这事儿了
&lt;img src="https://cdn.jsdelivr.net/gh/eatmoreduck/picture-repository/blog/WechatIMG5.jpg"
loading="lazy"
alt="WechatIMG5.jpg"
>&lt;/p>
&lt;h4 id="typora">Typora&lt;/h4>
&lt;p>1.0.0 之后开始收费，付费用户也可以选择此方案&lt;/p>
&lt;h4 id="vscode">VSCode&lt;/h4>
&lt;p>严格来说不是专为markdown 准备的，但配合插件使用可以实现较强的功能，开源，安装插件之后也能实现很好的写作效果，但个人习惯原因，不是很喜欢此方式，还是更偏向于使用专门的编辑器来进行编辑&lt;/p>
&lt;h4 id="obsidian">Obsidian&lt;/h4>
&lt;p>接下来Obsidian 隆重登场，Obsidian的优势&lt;/p>
&lt;ol>
&lt;li>开源&lt;/li>
&lt;li>原生Markdown 编辑，就算倒闭了，或者收费了，也方便迁移到其他平台&lt;/li>
&lt;li>插件市场活跃，配合Template插件，Image auto update plugin 以及Picgo 图床软件能实现不输语雀的编辑体验&lt;/li>
&lt;li>配合github 的workflow ，推送完代码之后，自动构建静态博客&lt;/li>
&lt;li>配合vercel 及自定义域名，代码推送到github 之后，自动部署到自己的网站&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/eatmoreduck/picture-repository/blog/202403041432583.png"
loading="lazy"
alt="image.png"
>&lt;/p></description></item></channel></rss>